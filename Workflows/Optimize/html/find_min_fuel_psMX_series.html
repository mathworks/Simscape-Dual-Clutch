<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      -->
<title>Dual Clutch Transmission - Optimization, 20 Parameters, patternsearch, Series Tests</title>
<meta name="generator" content="MATLAB 25.2">
<link rel="schema.DC" href="http://purl.org/dc/elements/1.1/">
<meta name="DC.date" content="2025-12-24">
<meta name="DC.source" content="find_min_fuel_psMX_series.m">
<style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style>
</head>
<body>
<div class="content">
<h1>Dual Clutch Transmission - Optimization, 20 Parameters, patternsearch, Series Tests</h1>
<!--introduction-->
<p>This example shows a vehicle with a five-speed automatic dual-clutch transmission. The transmission controller converts the pedal deflection into a demanded torque. This demanded torque is then passed to the engine management. The pedal deflection and the vehicle speed are also used by the transmission controller to determine when the gear shifts should occur. Gear shifts are implemented via the two clutches, one clutch pressure being ramped up as the other clutch pressure is ramped down. Gear pre-selection via dog clutches ensures that the correct gear is fully selected before the on-going clutch is enabled.</p>
<p>The script below uses an optimization algorithm to find shift map that maximizes fuel economy. The shift map is parameterized with 20 parameters. The tests are run sequentially on a single core so we can capture the results of each test and animate the evolution of the shift map.</p>
<!--/introduction-->
<h2>Contents</h2>
<div>
<ul>
<li>
<a href="#1">Setup Optimization</a>
</li>
<li>
<a href="#2">Run optimization using parallel computing</a>
</li>
</ul>
</div>
<h2 id="1">Setup Optimization</h2>
<p>Setup model</p>
<pre class="codeoutput">### Searching for referenced models in model 'Dual_Clutch_Trans'.
### Total of 1 models to build.
</pre>
<img vspace="5" hspace="5" src="find_min_fuel_psMX_series_01.png" alt=""> <h2 id="2">Run optimization using parallel computing</h2>
<pre class="codeoutput">

Iter     Func-count       f(x)      MeshSize     Method
    0           1       0.341992          0.05      
    1          47       0.341934           0.1     Successful Poll
    2          93       0.341831           0.2     Successful Poll
    3         100       0.341457           0.4     Successful Poll
patternsearch stopped because it exceeded options.MaxFunctionEvaluations.
Elapsed Sim Time = 405.8716
</pre>
<img vspace="5" hspace="5" src="find_min_fuel_psMX_series_02.png" alt=""> <p class="footer">Copyright 2014-2025 The MathWorks, Inc.<br>
<a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2025b</a>
<br>
</p>
</div>
<!--
##### SOURCE BEGIN #####
%% Dual Clutch Transmission - Optimization, 20 Parameters, patternsearch, Series Tests
%
% This example shows a vehicle with a five-speed automatic dual-clutch
% transmission. The transmission controller converts the pedal deflection
% into a demanded torque. This demanded torque is then passed to the engine
% management. The pedal deflection and the vehicle speed are also used by
% the transmission controller to determine when the gear shifts should
% occur. Gear shifts are implemented via the two clutches, one clutch
% pressure being ramped up as the other clutch pressure is ramped down.
% Gear pre-selection via dog clutches ensures that the correct gear is
% fully selected before the on-going clutch is enabled.
% 
% The script below uses an optimization algorithm to find shift map that
% maximizes fuel economy. The shift map is parameterized with 20
% parameters.  The tests are run sequentially on a single core so we can
% capture the results of each test and animate the evolution of the shift
% map.
%
% Copyright 2014-2025 The MathWorks, Inc.

%% Setup Optimization
% Setup model 
mdl = 'Dual_Clutch_Trans';
setup_model_optim_full

% Pre-generate rapid accelerator target
load_system(mdl);
rtp = Simulink.BlockDiagram.buildRapidAcceleratorTarget(mdl,'AddTunableParamInfo','on');
close_system(mdl);

% Offset parameters
delta0 = [10 12 12 10 10;...
    3  3  3  3  3;
    3  3  3  3  3;
    3  3  3  3  3];

% Reshape offsets into a vector so that it can be passed to the objective function
delta0_v = reshape(delta0,[],1);

% Shift boundaries must be separated to allow time to shift
% Shift boundaries must have a positive slope
%   Set lower bound for deltas (minimum difference between points)
LB = reshape([5 5 5 5 5;...
    1  1  1  1  1;
    1  1  1  1  1;
    1  1  1  1  1],[],1);

% Shift boundary lines must be separated by b
%   Create constraint for delta values according to Ax <= b
%   Delta(2,1) <= Delta(1,2) + Delta(2,2) + b
SubA = [0 1 0 0;0 1 1 0;0 1 1 1];
SubB = [-1 -1 0 0;-1 -1 -1 0;-1 -1 -1 -1];
Sub0 = zeros(size(SubA));

A =[SubA SubB Sub0 Sub0 Sub0;...
    Sub0 SubA SubB Sub0 Sub0;...
    Sub0 Sub0 SubA SubB Sub0;...
    Sub0 Sub0 Sub0 SubA SubB;...
    1 0 0 0 1 0 0 0 1 0 0 0 1 0 0 0 1 1 1 1];

mingdiff = -10; 
b = [mingdiff*ones(size(A,1)-1,1); 120];

% Plot initial shift map
[Upshift_Speeds, Downshift_Speeds, Pedal_Positions] = Calc_Shift_Map_DL(delta0,Pedal_Positions);
map_h=figure;
Plot_Gear_Shift_Schedule(Pedal_Positions,Upshift_Speeds,Downshift_Speeds);
set(gca,'XLim',[0 120])

%% Run optimization using parallel computing
%parpool;
%options = psoptimset('Vectorized','off','Display','iter','UseParallel','always',...
%    'TolMesh',0.0025,'CompletePoll','on','InitialMeshSize',0.05,'ScaleMesh','on');

% Run optimization without parallel computing

options = psoptimset('Vectorized','off','Display','iter','UseParallel','never',...
    'TolMesh',0.0025,'CompletePoll','on','InitialMeshSize',0.05,'ScaleMesh','on','MaxFunEvals',100);

DCT_minFuelOptResMX = [];

DCT_minFuelOptResMX.tableDeltas = delta0_v;
DCT_minFuelOptResMX.fuelUsed = 10;

% Call optimization function
tic;
[x,fval,exitflag,output] = ...
    patternsearch(@(x)obj_find_min_fuel_psMX(mdl,x,rtp,map_h,true),...
    delta0_v,A,b,[],[],LB,[],[],options);

Elapsed_Sim_Time = toc;
disp(['Elapsed Sim Time = ' num2str(Elapsed_Sim_Time)]);

% Update workspace variables with final values (based on x)
delta_final = reshape(x,4,[]);
[Upshift_Speeds_final, Downshift_Speeds_final, Pedal_Positions_final] = Calc_Shift_Map_DL(delta_final,Pedal_Positions);

% Save key results of optimization
%{
trans_var = get_param([mdl '/Dual Clutch Transmission'],'BlockChoice');
veh_var = get_param([mdl '/Vehicle Dynamics'],'BlockChoice');
solver_setting = get_param(mdl,'Solver');
if (strcmp(solver_setting,'ode23t'))
    solver_var = 'Desktop';
else
    solver_var = 'Real Time';
end

SaveVarName = ['OptPSMX_' trans_var(1:3) solver_var(1:3) '_DC' num2str(Drive_Cycle_Num)];

eval([SaveVarName '.delta0 = delta0;']);
eval([SaveVarName '.delta_final = delta_final;']);
eval([SaveVarName '.Elapsed_Sim_Time = Elapsed_Sim_Time;']);
eval([SaveVarName '.FuncCount = output.funccount;']);
eval([SaveVarName '.FuelUsedMin = fval;']);
eval([SaveVarName '.Variants.Transmission = ''' trans_var ''';']);
eval([SaveVarName '.Variants.Vehicle = ''' veh_var ''';']);
eval([SaveVarName '.Variants.SolverSettings = ''' solver_var ''';']);

save(SaveVarName, SaveVarName);
%}

%figure(2)
%Plot_Gear_Shift_Schedule(Pedal_Positions_final,Upshift_Speeds_final,Downshift_Speeds_final);
%set(gca,'XLim',[0 120])

%saveas(gcf,SaveVarName,'fig');

% Reset model REPLACE_WITH_DASH_DASH remove settings specific to optimization
delete(gcp('nocreate'))
reset_model_optim

datestringfile = datestr(now,'yymmddHHMM');

save(['DCT_minFuelOptResMX_' datestringfile '.mat'], 'DCT_minFuelOptResMX');

%save DCT_minFuelOptResMX



##### SOURCE END #####
-->
</body>
</html>
